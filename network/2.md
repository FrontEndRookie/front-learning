###### 3 次握手

![image-20240507154545480](/Users/xuminghui/Library/Application Support/typora-user-images/image-20240507154545480.png)

###### 四次挥手

![image-20240507180848231](/Users/xuminghui/Library/Application Support/typora-user-images/image-20240507180848231.png)

![image-20240507181620795](/Users/xuminghui/Library/Application Support/typora-user-images/image-20240507181620795.png)

###### 网络层

![image-20240507155033497](/Users/xuminghui/Library/Application Support/typora-user-images/image-20240507155033497.png)

![image-20240507154845393](/Users/xuminghui/Library/Application Support/typora-user-images/image-20240507154845393.png)

![image-20240507154919760](/Users/xuminghui/Library/Application Support/typora-user-images/image-20240507154919760.png)

![image-20240507155010202](/Users/xuminghui/Library/Application Support/typora-user-images/image-20240507155010202.png)

###### tcp 重传机制

![image-20240507182145853](/Users/xuminghui/Library/Application Support/typora-user-images/image-20240507182145853.png)

**rtt：往返时延**

![image-20240507182245288](/Users/xuminghui/Library/Application Support/typora-user-images/image-20240507182245288.png)

![image-20240507182502169](/Users/xuminghui/Library/Application Support/typora-user-images/image-20240507182502169.png)

因为 RTT 的值可能是经常变化的（网络变化）导致 RTO 的值也应该是一个动态变化的值，网络差时时间就会很长，

于是就有**快速重传**来解决该问题

![image-20240507183325586](/Users/xuminghui/Library/Application Support/typora-user-images/image-20240507183325586.png)

![image-20240507183512831](/Users/xuminghui/Library/Application Support/typora-user-images/image-20240507183512831.png)

**sack 重传**

tcp 快速重传导致丢包的原因有很多（网络延迟、乱序到达的数据包等），导致无法确认具体是丢失的哪一个包。sack 重传会在 tcp 头部字段里加一个 sack（相当于加个标识），确认丢失的数据包，保证只重传丢失的数据包。

###### Tcp 拥塞控制

```
在网络出现拥堵时，如果继续发送大量数据包，可能会导致数据包时延丢包等情况进而开始进行重传，这样会进一步导致网络的负担加重，拥塞控制的目的就是避免发送方的数据填满整个网络。

拥塞控制的四个算法：
慢启动：一点一点的提高发送数据包的数量 当网络良好时，拥塞窗口的cwnd的大小就会递增（指数增加1-2-4-8），到慢开始门限ssthresh后进入拥塞避免。
拥塞避免：拥塞窗口线性增长，cwnd递增1。直至达到网络阻塞后，进入慢启动并设置慢开始门限此前网络阻塞时cwnd的一半
快速重传：发送方尽快重传而不是等rto时间到了才重传 （连续收到三次失序报文直接重传）
快恢复：触发快速重传时直接将慢开始门限和cwnd值设为当前拥塞窗口的一半然后进入拥塞避免状态

拥塞窗口和滑动窗口区别：
拥塞窗口根据的是当前网络情况，滑动窗口根据服务端接收能力
```
