# 点对点通信

WebRTC，英语全称是 Web Real Time Communication，是一项实时通信技术，它允许网络应用在不借助中间媒介的情况下建立**<u>浏览器之间点对点</u>**的连接，实现视频流、音频流以及其他任意格式的数据传输。

![image-20240126125223009](https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2024-01-26-045223.png)

WebRTC 项目始于 2011 年，Google 购买了一家名为 Global IP Solutions（GIPS）的公司，后者拥有一系列语音和视频通信技术。Google 将这些技术的一部分开源，并推动 WebRTC 成为一个开放的网络标准。自那以后，WebRTC 经过多年的发展和改进，得到了 W3C 和 IETF 的正式标准化。WebRTC 的出现，使用户在无须安装任何插件或者第三方软件的情况下，仅基于浏览器创建点对点的数据分享成为可能。



两个设备之间要建立WebRTC连接，就需要一个**<u>信令服务器</u>**。

信令服务器以一个“中间人”的身份帮助双方在尽可能少地暴露隐私的情况下建立连接。

比如对于音视频通话的应用来说，两端的媒体编码格式、媒体分辨率信息就是通过信令服务器互相告知对方的（这就是媒体协商），所以信令服务器最好是一个公网上的服务器，两个设备都能与这台服务器无障碍地通信。



WebRTC里面有一些核心的概念：

- STUN（Session Traversal Utilities for NAT）：STUN 服务器的主要作用是帮助端点发现其公网上的IP地址和端口号。当一个 WebRTC 应用启动时，它会向 STUN 服务器发送一个请求，STUN 服务器会回应这个端点在互联网上的公网地址和端口。这被称为 NAT 穿透。
- TURN（Traversal Using Relays around NAT）：TURN 服务器是 STUN 的一个扩展，它实际上是一个中继服务器。当 STUN 无法帮助端点建立直接连接时，TURN 服务器可以中继两个端点之间的数据包。

概括起来，sturn/turn服务器，都是在 WebRTC 通信中使用的服务器，它们帮助处理 NAT（网络地址转换）和防火墙带来的问题，使得位于这些网络限制后的设备能够相互通信。



具体的过程是两个设备通过sturn/turn服务器获取到自己映射在公网上的IP地址和端口号，再通过信令服务器告诉对方，这样双方就知道彼此的IP地址和端口号了，两个设备就可以基于此建立连接，这就是P2P打洞，也就是网络协商。注意，由于网络环境复杂，连接很可能没办法成功建立，此时sturn/turn服务器会协助传输数据，保证应用功能的正确性。



Coturn（https://github.com/coturn/coturn）就是一个实现了sturn/turn协议的开源项目。它是基于C++开发的，性能非常不错，国内外很多大厂都基于它搭建sturn/turn服务器。

不过对于我们来讲，基于 C++ 的 Coturn 项目不太适合我们，这里我选择使用前端工程师更容易理解的 PeerJS（https://github.com/peers）项目构建WebRTC工程。
